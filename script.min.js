document.addEventListener("DOMContentLoaded",()=>{function a(a){if(!a)return"";const b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.toString().replace(/[&<>"']/g,a=>b[a])}function b(){const a=document.querySelector("[data-v-app]");return a?.__vue_app__?.config?.globalProperties?.$_state||null}function c(){const a=document.getElementById("bricks-structure");if(!a)return;let b;const c=new MutationObserver(()=>{clearTimeout(b),b=setTimeout(()=>d(a),50)});c.observe(a,{childList:!0,subtree:!0}),d(a)}function d(a){const b=a.querySelectorAll("li[data-id]:not(.has-bbem-btn)");b.forEach(a=>{if(!a.querySelector(".bbem-trigger-btn")){let b=a.querySelector(".actions")||a.querySelector(".structure-item-actions")||a;const c=document.createElement("div");c.className="bbem-trigger-btn",c.textContent="BEM",c.addEventListener("click",b=>{b.stopPropagation();const c=document.querySelector(".bbem-draggable-panel");c&&c.remove(),j(a.getAttribute("data-id"))}),b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c),a.classList.add("has-bbem-btn")}})}function e(a){const c=b();return c?[...(c.header||[]),...(c.content||[]),...(c.footer||[])].find(b=>b.id===a):null}function f(a,b=[],c=0){const d=e(a);return d&&d.children?(d.children.forEach(a=>{const d=e(a);d&&(b.push({...d,depth:c+1}),f(a,b,c+1))}),b):b}function g(a){return(a||"element").toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function h(a,b){let c=a.replace(b+"__","");return c.replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,a=>a.toUpperCase())}function i(a=440){const b=document.getElementById("bricks-structure");let c=350,d=100;if(b){const a=b.getBoundingClientRect();c=a.right+10,d=a.top+40}return c+a>window.innerWidth&&(c=window.innerWidth-a-20),{left:c,top:d}}function j(b){const c=e(b);if(!c)return;const d=c.label||c.name||"block",h=g(d),j=document.createElement("div");j.className="bbem-draggable-panel";let m="";[c,...f(b)].forEach(c=>{const d=c.label||c.name||"element",e=a(d),f=a(h),i=c.id===b?"BLOCK":"ELEMENT",j=c.depth||0,k=c.id===b,l=g(e),n=o.showModifiers?"":"hide-mods";let p="";p=k?`
                    <div class="bbem-class-wrapper">
                        <input type="text" class="bbem-class-name inner-input" value="${f}" data-is-block="true">
                    </div>`:`
                    <div class="bbem-class-wrapper">
                        <span class="bbem-block-prefix">${f}__</span>
                        <input type="text" class="bbem-class-name inner-input" value="${l}" data-is-block="false">
                    </div>`,m+=`
                <div class="bbem-row" data-id="${c.id}">
                    <div class="bbem-indent-wrapper bbem-indent-${Math.min(j,3)}">
                        <div class="bbem-label-group">
                            <span class="bbem-original-name">${e}</span>
                            <span class="bbem-tag">${i}</span>
                        </div>
                        <div class="bbem-input-group ${n}">
                            ${p}
                            <input type="text" class="bbem-input bbem-modifier" placeholder="mod">
                        </div>
                    </div>
                    <div class="bbem-checkbox-col">
                        <input type="checkbox" class="bbem-include-checkbox" checked title="Include">
                    </div>
                </div>`});const n=o.showLabels?"":"hide-labels",p=o.showModifiers?"mods-active":"",q=o.showModifiers?"active":"",r=a(d);j.innerHTML=`
            <div class="bbem-header" id="bbem-drag-handle">
                <h2>BEM: ${r}</h2>
                <button class="bbem-close">&times;</button>
            </div>
            
            <div class="bbem-toolbar ${p}">
                <div class="bbem-general-group">
                    <label class="bbem-toggle-group">
                        <div class="bbem-switch">
                            <input type="checkbox" id="bbem-toggle-replace" ${o.replaceMode?"checked":""}>
                            <span class="bbem-slider"></span>
                        </div>
                        <span class="bbem-toggle-label">Replace</span>
                    </label>
                    <label class="bbem-toggle-group">
                        <div class="bbem-switch">
                            <input type="checkbox" id="bbem-toggle-sync" ${o.syncLabels?"checked":""}>
                            <span class="bbem-slider"></span>
                        </div>
                        <span class="bbem-toggle-label">Sync</span>
                    </label>
                </div>

                <div class="bbem-separator"></div>
                <button class="bbem-text-toggle ${q}" id="bbem-toggle-mods-vis">MODIFIER</button>
                <span class="bbem-toggle-label" id="bbem-select-all-btn" style="margin-left:auto; cursor:pointer; color:var(--bbem-accent);">None</span>
            </div>

            <div class="bbem-body ${n}">${m}</div>
            
            <div class="bbem-footer">
                <div class="bbem-footer-left">
                    <label class="bbem-toggle-group">
                        <div class="bbem-switch">
                            <input type="checkbox" id="bbem-toggle-labels" ${o.showLabels?"checked":""}>
                            <span class="bbem-slider"></span>
                        </div>
                        <span class="bbem-toggle-label">Labels</span>
                    </label>
                </div>
                <div class="bbem-footer-right">
                    <button class="bbem-btn bbem-btn-secondary bbem-close-btn">Cancel</button>
                    <button class="bbem-btn bbem-btn-primary" id="bbem-apply">Apply</button>
                </div>
            </div>
        `,document.body.appendChild(j);const s=i(440);j.style.left=s.left+"px",j.style.top=s.top+"px",requestAnimationFrame(()=>{j.style.opacity="1"}),k(j),l(j)}function k(a){const b=a.querySelector("#bbem-drag-handle");if(!b)return;let c,d,f,g,h=!1;b.onmousedown=i=>{h=!0,c=i.clientX,d=i.clientY;const e=a.getBoundingClientRect();f=e.left,g=e.top,a.style.transform="none",b.style.cursor="grabbing",document.body.style.userSelect="none"},document.onmousemove=b=>{h&&(b.preventDefault(),a.style.left=`${f+(b.clientX-c)}px`,a.style.top=`${g+(b.clientY-d)}px`)},document.onmouseup=()=>{h=!1,b.style.cursor="grab",document.body.style.userSelect=""}}function l(a){const b=a.querySelector(".bbem-toolbar"),c=(b,c)=>{const d=a.querySelector(b);d&&d.addEventListener("change",a=>{o[c]=a.target.checked,localStorage.setItem(n,JSON.stringify(o))})};c("#bbem-toggle-replace","replaceMode"),c("#bbem-toggle-sync","syncLabels");const d=a.querySelector("#bbem-toggle-labels"),f=a.querySelector(".bbem-body");d&&d.addEventListener("change",a=>{o.showLabels=a.target.checked,localStorage.setItem(n,JSON.stringify(o)),a.target.checked?f.classList.remove("hide-labels"):f.classList.add("hide-labels")});const h=a.querySelector("#bbem-toggle-mods-vis");h&&h.addEventListener("click",()=>{const c=h.classList.toggle("active");o.showModifiers=c,localStorage.setItem(n,JSON.stringify(o));const d=a.querySelectorAll(".bbem-input-group");d.forEach(a=>c?a.classList.remove("hide-mods"):a.classList.add("hide-mods")),c?b.classList.add("mods-active"):b.classList.remove("mods-active")});const i=a.querySelector("input[data-is-block=\"true\"]");i&&i.addEventListener("input",b=>{const c=g(b.target.value),d=a.querySelectorAll(".bbem-block-prefix");d.forEach(a=>{a.textContent=c?`${c}__`:""})}),a.querySelectorAll(".bbem-class-name").forEach(a=>{a.addEventListener("input",a=>{const b=a.target.closest(".bbem-class-wrapper");b&&(a.target.value.trim()?(b.classList.remove("bbem-input-error"),b.classList.remove("bbem-shake")):b.classList.add("bbem-input-error"))})}),a.querySelectorAll(".bbem-class-wrapper").forEach(a=>{a.addEventListener("click",()=>{const b=a.querySelector("input");b&&b.focus()})});const j=a.querySelector("#bbem-select-all-btn");if(j){let b=!0;j.addEventListener("click",()=>{b=!b,a.querySelectorAll(".bbem-include-checkbox").forEach(a=>{a.checked=b;const c=a.closest(".bbem-row"),d=c.querySelector(".bbem-class-wrapper"),e=c.querySelector(".bbem-class-name");b?(c.classList.remove("disabled"),e&&!e.value.trim()&&d&&d.classList.add("bbem-input-error")):(c.classList.add("disabled"),d&&(d.classList.remove("bbem-input-error"),d.classList.remove("bbem-shake")))}),j.textContent=b?"None":"All"})}a.querySelectorAll(".bbem-include-checkbox").forEach(a=>{a.addEventListener("change",a=>{const b=a.target.closest(".bbem-row"),c=b.querySelector(".bbem-class-wrapper"),d=b.querySelector(".bbem-class-name");a.target.checked?(b.classList.remove("disabled"),d&&!d.value.trim()&&c&&c.classList.add("bbem-input-error")):(b.classList.add("disabled"),c&&(c.classList.remove("bbem-input-error"),c.classList.remove("bbem-shake")))})});const k=()=>a.remove();a.querySelectorAll(".bbem-close, .bbem-close-btn").forEach(a=>a.onclick=k);const l=document.getElementById("bbem-apply");l&&(l.onclick=()=>{let b=!0;a.querySelectorAll(".bbem-row").forEach(a=>{if(!a.querySelector(".bbem-include-checkbox").checked)return;const c=a.querySelector(".bbem-class-name"),d=a.querySelector(".bbem-class-wrapper");c.value.trim()?(d.classList.remove("bbem-input-error"),d.classList.remove("bbem-shake")):(b=!1,d.classList.add("bbem-input-error"),d.classList.remove("bbem-shake"),void d.offsetWidth,d.classList.add("bbem-shake"))}),b&&(m(a),k())})}function m(a){let c=0;const d=b(),f=a.querySelector("#bbem-toggle-replace").checked,i=a.querySelector("#bbem-toggle-sync").checked;a.querySelectorAll(".bbem-row").forEach(b=>{if(!b.querySelector(".bbem-include-checkbox").checked)return;const j=b.dataset.id,k=b.querySelector(".bbem-class-name"),l="true"===k.dataset.isBlock,m=g(k.value);let n=m;if(!l){const a=b.querySelector(".bbem-block-prefix"),c=a?a.textContent:"";n=c+m}const o=b.querySelector(".bbem-modifier").value.trim();if(!n)return;let p=[],q=o;q&&!q.startsWith("--")&&(q="--"+q);const r=!!q;if(r){const a=`${n}${q}`;p=[a]}else p=[n];const s=e(j);if(s&&(s.settings||(s.settings={}),f&&!r&&(s.settings._cssGlobalClasses=[]),s.settings._cssGlobalClasses||(s.settings._cssGlobalClasses=[]),p.forEach(a=>{let b=d.globalClasses.find(b=>b.name===a);b||(b={id:Math.random().toString(36).slice(2,8),name:a,settings:{}},d.globalClasses.push(b)),s.settings._cssGlobalClasses.includes(b.id)||(s.settings._cssGlobalClasses.push(b.id),c++)}),i&&!r)){const b=p[0],c=a.querySelector("input[data-is-block=\"true\"]").value.trim();let d=h(b,c);d&&""!==d.trim()||(d=b.replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,a=>a.toUpperCase())),s.label=d,setTimeout(()=>{const a=[`li[data-id="${j}"] .structure-item-title span.text`,`li[data-id="${j}"] .structure-item-title span`,`li[data-id="${j}"] .name`];for(const b of a){const a=document.querySelector(b);if(a){a.innerText=d;break}}},50)}}),(0<c||i)&&(d.globalClasses.push({}),setTimeout(()=>d.globalClasses.pop(),50))}const n="bbem_settings";let o=JSON.parse(localStorage.getItem("bbem_settings"))||{replaceMode:!1,syncLabels:!0,showModifiers:!1,showLabels:!0};const p=setInterval(()=>{const a=document.querySelector("[data-v-app]");a&&a.__vue_app__&&(clearInterval(p),c())},500)});